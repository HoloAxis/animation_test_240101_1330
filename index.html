<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>three.jsでGLBファイルを表示する</title>
    <style>
      body {
        margin: 0;
        background-color: rgb(118, 120, 139);
      }
      canvas {
        display: block;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@v0.151.3/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@v0.151.3/examples/jsm/"
        }
      }
    </script>
  </head>
  <body>
    <script type="module">
      import * as THREE from 'three';
      import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
      import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
      import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.001,
          1000
      );
      camera.position.z = 5;

      const renderer = new THREE.WebGLRenderer();
      renderer.setClearColor(0xffffff, 0);
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.zoomSpeed = 0.5;
      controls.update();

      const ambientLight = new THREE.AmbientLight(0xffffff, 1);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
      directionalLight.position.set(0, 1, 1);
      scene.add(directionalLight);

      const loader = new GLTFLoader();
      const dracoLoader = new DRACOLoader();
      dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.4.1/');
      loader.setDRACOLoader(dracoLoader);

      const clock = new THREE.Clock();

      const textureLoader = new THREE.TextureLoader();
      textureLoader.load(
          'thin.jpg',
          //'gradation.png',
          function (texture) {
              scene.background = texture;
          },
          undefined,
          function (error) {
              console.error(error);
          }
      );

      let mixer_1, mixer_2;

      loader.load(
          "three_240101_0955.gltf",
          function (gltf_1) {
              mixer_1 = new THREE.AnimationMixer(gltf_1.scene);
              gltf_1.animations.forEach((clip) => {
                  mixer_1.clipAction(clip).play();
              });
              scene.add(gltf_1.scene);
          },
          undefined,
          function (error) {
              console.error(error);
          }
      );

      loader.load(
          "three_240101_1600.gltf",
          function (gltf_2) {
              mixer_2 = new THREE.AnimationMixer(gltf_2.scene);
              gltf_2.animations.forEach((clip) => {
                  mixer_2.clipAction(clip).play();
              });
              scene.add(gltf_2.scene);
          },
          undefined,
          function (error) {
              console.error(error);
          }
      );

      function update() {
          if (mixer_1) {
              mixer_1.update(clock.getDelta());
          }
          if (mixer_2) {
              mixer_2.update(clock.getDelta());
          }
      }

      renderer.setAnimationLoop(() => {
          update();
          directionalLight.position.copy(camera.position);
          renderer.render(scene, camera);
      });
    </script>
  </body>
</html>
